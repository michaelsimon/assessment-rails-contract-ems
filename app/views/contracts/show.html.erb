<%= render partial: "edit_links", locals: {resource: @contract,  text: true, displaytype: "page"} %>
<h1><%= @contract.performance.name %></h1>
<p>
  <strong>Date: </strong><%= fmatdate(@contract.performance.perf_date) %> <%= link_to "#{icon('arrow-circle-right')}".html_safe , performance_path(@contract.performance) %><br>
  <strong>Venue: </strong><%= @contract.performance.venue.name %> <%= link_to "#{icon('arrow-circle-right')}".html_safe , venue_path(@contract.performance.venue) %><br>
  <strong>Act: </strong><%= @contract.performance.act.name %> <%= link_to "#{icon('arrow-circle-right')}".html_safe , act_path(@contract.performance.act) %>
</p>
<p>
  <strong>Submit Date: </strong><%= fmatdate(@contract.submit_date) %><br>
  <strong>Due Date: </strong><%= fmatdate(@contract.due_date) %><br>
  <strong>Status: </strong><%= @contract.status_value %>
</p>
<p>
  <strong>Contract Details: </strong><br /><%= @contract.performance.description %>
</p>
<h3>Documents</h3>
<% if policy(:contract).new? %><p><%= link_to "#{icon('file-o')} New Document".html_safe, "#", data: {toggle: "modal", target: "#modalDocument"}%></p><% end %>
<div class="modal fade" id="modalDocument" tabindex="-1" role="dialog" aria-labelledby="modalDocument">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="modalDocTitle">New Document</h4>
      </div>
      <%= form_for [@contract, @document] do |f| %>
      <div class="modal-body">

<%= render partial: "shared/errors", locals: {md: @document} %>
<%= f.label :name %>
<%= f.text_field :name, class: "form-control" %><br>
<%= f.label :description %>
<%= f.text_field :description, class: "form-control" %><br>
<%= f.label :location %>
<%= f.text_field :location, class: "form-control" %><br>
<%= f.hidden_field :contract_id, value: @contract.id %>

</div>
<div class="modal-footer">
  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
  <%= f.submit id: "modalSubmit", class: "btn btn-primary" %>
</div>
<% end %>
<script type="text/javascript">
$(document).ready(function() {
  $('form').on('submit', function(event){
    event.preventDefault();
    $.ajax({
      url: event.currentTarget.action,
      type: 'POST',
      dataType: 'JSON',
      data: $(this).serialize()
    }).done(function(response, stat){
      $('#documents > tbody').append(`<tr><td><a href="${response.location}">${response.name}</a></td><td>${response.description}</td><td>buttons</td></tr>`)
      $('#modalDocument').modal("hide");

    });
  });
});

$(document).ready(function() {
  $('a#edit-doc').on('click', function(event){
    event.preventDefault();
    $.get(event.currentTarget.pathname, function() {
    }).done(function(response, stat){
      $('form').attr({
        class: 'edit_document',
        id: `edit_document_${response.id}`,
        action: `/contracts/${response.contract_id}/documents/${response.id}`
      });
      $('form').append('<input type="hidden" name="_method" value="patch" />');
      $('#document_name').val(response.name);
      $('#document_description').val(response.description);
      $('#document_location').val(response.location);
      $('#modalDocTitle').html("Edit Document");
      $('#modalSubmit').attr('value','Update Document');
      $('#modalDocument').modal("show");
    });
  });
});
</script>

</div>
</div>
</div>
<div class="panel panel-default col-sm-11">
  <table class="table" id="documents">
    <thead>
      <tr>
        <th>Document</th>
        <th>Description</th>
        <th>&nbsp;</th>
      </tr>
    </thead>
    <tbody>
      <%= render partial: "document", collection: @documents %>
    </tbody>
  </table>
</div>
<h3>Approvals</h3>
<div class="panel panel-default col-sm-11">
  <table class="table">
    <thead>
      <tr>
        <th>Representative</th>
        <th>Role</th>
        <th>Date Requested</th>
        <th>Date Answered</th>
        <th>Status</th>
        <th>&nbsp;</th>
      </tr>
    </thead>
    <tbody>
      <%= render partial: "approval", collection: @approvals %>
    </tbody>
  </table>
</div>
